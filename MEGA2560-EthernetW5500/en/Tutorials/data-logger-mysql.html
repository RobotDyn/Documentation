<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>data-logger-mysql</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1>Data Logger with MySQL</h1>
<p>In this example we will build a simple temperature data logger that will send data to a remote MySQL database. Every mesurement will be accompanied with a corresponding timestamp, hence we'll need a sensor moduole and a real time clock module</p>
<h2>Hardware</h2>
<ol>
<li>Mega ETH board</li>
<li>DHT11 temperature/humidity sensor</li>
<li>RTC (Real Time Clock) DS1307 module</li>
<li>one breadboard</li>
<li>connecting wires</li>
</ol>
<p>The RTC moduleuses I2C pins SDA and SCL, DHT11 - to pins 7 and 8 of the Mega ETH board.</p>
<h2>The Software</h2>
<p>First we need to set up a MySQL database server. Let's assume that we install it on a computer with an ip address of 192.168.1.33 on our local network and create a database <code>robologger</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb1-1" title="1">mysql<span class="op">&gt;</span> <span class="kw">create</span> <span class="kw">database</span> robologger</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">Query</span> OK, <span class="dv">1</span> <span class="kw">row</span> affected (<span class="fl">0.00</span> sec)</a>
<a class="sourceLine" id="cb1-3" title="3">mysql<span class="op">&gt;</span> <span class="kw">use</span> robologger;</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">database</span> changed</a>
<a class="sourceLine" id="cb1-5" title="5">mysql<span class="op">&gt;</span> <span class="kw">create</span> <span class="kw">table</span> sensdata (<span class="kw">id</span> <span class="dt">float</span>(<span class="dv">6</span>,<span class="dv">0</span>) <span class="kw">not</span> <span class="kw">null</span> auto_increment <span class="kw">primary</span> <span class="kw">key</span>, <span class="dt">date</span> <span class="dt">date</span>, <span class="dt">time</span> <span class="dt">time</span>, temp <span class="dt">float</span> (<span class="dv">5</span>,<span class="dv">2</span>), humi <span class="dt">float</span>(<span class="dv">4</span>,<span class="dv">2</span>) );</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">Query</span> OK, <span class="dv">0</span> <span class="kw">rows</span> affected (<span class="fl">0.01</span> sec)</a>
<a class="sourceLine" id="cb1-7" title="7">mysql<span class="op">&gt;</span> <span class="kw">insert</span> <span class="kw">into</span> sensdata (<span class="dt">date</span>, <span class="dt">time</span>, temp, humi) <span class="kw">values</span> (<span class="st">&#39;2019-11-10&#39;</span>,<span class="st">&#39;14:11:00&#39;</span>, <span class="fl">32.4</span>, <span class="fl">97.8</span>);</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">Query</span> OK, <span class="dv">1</span> <span class="kw">row</span> affected (<span class="fl">0.00</span> sec)</a></code></pre></div>
<p>Next we will grant access to the user robotdyn to this database:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb2-1" title="1">mysql<span class="op">&gt;</span> <span class="kw">grant</span> <span class="kw">all</span> <span class="kw">privileges</span> <span class="kw">ON</span> robologger.<span class="op">*</span> <span class="kw">to</span> <span class="st">&#39;robotdyn&#39;</span>@<span class="st">&#39;192.168.1.%&#39;</span> <span class="kw">identified</span> <span class="kw">by</span> <span class="st">&#39;robotdyn&#39;</span> <span class="kw">with</span> <span class="kw">grant</span> <span class="kw">option</span>;</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">Query</span> OK, <span class="dv">0</span> <span class="kw">rows</span> affected (<span class="fl">0.00</span> sec)</a>
<a class="sourceLine" id="cb2-3" title="3">mysql<span class="op">&gt;</span> <span class="kw">flush</span> <span class="kw">privileges</span>;</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">Query</span> OK, <span class="dv">0</span> <span class="kw">rows</span> affected (<span class="fl">0.00</span> sec)</a>
<a class="sourceLine" id="cb2-5" title="5">mysql<span class="op">&gt;</span> quit;</a></code></pre></div>
<p>Now, in our sketch we will need to connect to the Internet and set the RTC using NTP protocol. Then, using the Real Time Clock and every 10 minutes we log time, sensor data and send it to the database.</p>
<p>We will need an updated <a href="http://www.pjrc.com/teensy/td_libs_Time.html">Time library</a>. Download and extract it to your project folder.</p>
<p>For DHT11 we will use <a href="https://github.com/practicalarduino/SHT1x">this library</a> Please rename the extracted SHT1x-master to SHT1xmaster.</p>
<p>Then, we will need the MySQL connector libraries from <a href="https://launchpad.net/mysql-arduino">https://launchpad.net/mysql-arduino</a>.</p>
<p>In mysql.h uncomment the line:</p>
<pre><code>#define WITH_SELECT // Uncomment this for use without SELECT capability
</code></pre>
<p>Try compiling the code. You can find additional info on the use of MySQL connector on <a href="http://drcharlesbell.blogspot.ro/2013/04/introducing-mysql-connectorarduino_6.html">Chuck's blog</a>.</p>
<p>The code:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb4-1" title="1"><span class="pp">#include </span><span class="im">&lt;SPI.h&gt;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="pp">#include </span><span class="im">&lt;Ethernet.h&gt;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="pp">#include </span><span class="im">&lt;Dns.h&gt;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="pp">#include </span><span class="im">&lt;Time.h&gt;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="pp">#include </span><span class="im">&lt;Wire.h&gt;</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="pp">#include </span><span class="im">&lt;DS1307RTC.h&gt;</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="pp">#include </span><span class="im">&lt;SHT1x.h&gt;</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="pp">#include </span><span class="im">&lt;sha1.h&gt;</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="pp">#include </span><span class="im">&lt;mysql.h&gt;</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></a>
<a class="sourceLine" id="cb4-11" title="11"></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">/* ******** Ethernet Card Settings ******** */</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">// Set this to your Ethernet Card Mac Address</span></a>
<a class="sourceLine" id="cb4-14" title="14">byte mac[] = {<span class="bn">0x90</span>, <span class="bn">0xA2</span>, <span class="bn">0xDA</span>, <span class="bn">0x0D</span>, <span class="bn">0xFE</span>, <span class="bn">0x43</span> };</a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">/* ******** NTP Server Settings ******** */</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">/* us.pool.ntp.org NTP server</span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co">(Set to your time server of choice) */</span></a>
<a class="sourceLine" id="cb4-19" title="19">IPAddress timeServer;</a>
<a class="sourceLine" id="cb4-20" title="20"></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="co">/* Set this to the offset (in seconds) to your local time</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="co">This example is GMT + 2 */</span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="at">const</span> <span class="dt">long</span> timeZoneOffset = <span class="dv">7200</span><span class="bu">L</span>;</a>
<a class="sourceLine" id="cb4-24" title="24"></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="co">/* Syncs to NTP server every 15 seconds for testing,</span></a>
<a class="sourceLine" id="cb4-26" title="26"><span class="co">   set to 1 hour or more to be reasonable */</span></a>
<a class="sourceLine" id="cb4-27" title="27"><span class="dt">unsigned</span> <span class="dt">int</span> ntpSyncTime = <span class="dv">15</span>;        </a>
<a class="sourceLine" id="cb4-28" title="28"></a>
<a class="sourceLine" id="cb4-29" title="29"><span class="co">/* ALTER THESE VARIABLES AT YOUR OWN RISK */</span></a>
<a class="sourceLine" id="cb4-30" title="30"><span class="co">// local port to listen for UDP packets</span></a>
<a class="sourceLine" id="cb4-31" title="31"><span class="dt">unsigned</span> <span class="dt">int</span> localPort = <span class="dv">8888</span>;</a>
<a class="sourceLine" id="cb4-32" title="32"><span class="co">// NTP time stamp is in the first 48 bytes of the message</span></a>
<a class="sourceLine" id="cb4-33" title="33"><span class="at">const</span> <span class="dt">int</span> NTP_PACKET_SIZE= <span class="dv">48</span>;      </a>
<a class="sourceLine" id="cb4-34" title="34"><span class="co">// Buffer to hold incoming and outgoing packets</span></a>
<a class="sourceLine" id="cb4-35" title="35">byte packetBuffer[NTP_PACKET_SIZE];  </a>
<a class="sourceLine" id="cb4-36" title="36"><span class="co">// A UDP instance to let us send and receive packets over UDP</span></a>
<a class="sourceLine" id="cb4-37" title="37">EthernetUDP Udp;                    </a>
<a class="sourceLine" id="cb4-38" title="38">       </a>
<a class="sourceLine" id="cb4-39" title="39"></a>
<a class="sourceLine" id="cb4-40" title="40"><span class="co">/* ********** RTC Time settings ********* */</span></a>
<a class="sourceLine" id="cb4-41" title="41"><span class="dt">tmElements_t</span> tm;</a>
<a class="sourceLine" id="cb4-42" title="42"><span class="dt">int</span> minutes_now;</a>
<a class="sourceLine" id="cb4-43" title="43"><span class="dt">int</span> minutes_next;</a>
<a class="sourceLine" id="cb4-44" title="44"></a>
<a class="sourceLine" id="cb4-45" title="45"><span class="co">/* ******* Settings for the SHT1x sensor  */</span></a>
<a class="sourceLine" id="cb4-46" title="46"><span class="pp">#define dataPin  </span><span class="dv">9</span></a>
<a class="sourceLine" id="cb4-47" title="47"><span class="pp">#define clockPin </span><span class="dv">8</span></a>
<a class="sourceLine" id="cb4-48" title="48">SHT1x sht1x(dataPin, clockPin);</a>
<a class="sourceLine" id="cb4-49" title="49"><span class="dt">float</span> temp_c;</a>
<a class="sourceLine" id="cb4-50" title="50"><span class="dt">float</span> humidity;</a>
<a class="sourceLine" id="cb4-51" title="51"></a>
<a class="sourceLine" id="cb4-52" title="52"><span class="co">/* ***** MySQl Server settings ********** */</span></a>
<a class="sourceLine" id="cb4-53" title="53">Connector my_conn;        <span class="co">// The Connector/Arduino reference</span></a>
<a class="sourceLine" id="cb4-54" title="54">IPAddress server_addr(<span class="dv">192</span>, <span class="dv">168</span>, <span class="dv">1</span>, <span class="dv">133</span>);  <span class="co">// IP address of MySQL server</span></a>
<a class="sourceLine" id="cb4-55" title="55"><span class="dt">char</span> user[] = <span class="st">&quot;robotdyn&quot;</span>;</a>
<a class="sourceLine" id="cb4-56" title="56"><span class="dt">char</span> password[] = <span class="st">&quot;robotdyn&quot;</span>;</a>
<a class="sourceLine" id="cb4-57" title="57"><span class="co">// maximum tries to connect</span></a>
<a class="sourceLine" id="cb4-58" title="58"><span class="dt">int</span> num_fails;</a>
<a class="sourceLine" id="cb4-59" title="59"><span class="pp">#define MAX_FAILED_CONNECTS </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb4-60" title="60"><span class="co">// We define some strings</span></a>
<a class="sourceLine" id="cb4-61" title="61"><span class="dt">char</span> myquery[<span class="dv">150</span>];  <span class="co">// more than enough; stores command to print table content</span></a>
<a class="sourceLine" id="cb4-62" title="62"><span class="dt">char</span> insquery[<span class="dv">200</span>]; <span class="co">// more than enough; stores command to insert new data</span></a>
<a class="sourceLine" id="cb4-63" title="63"><span class="at">const</span> <span class="dt">char</span> testselect[] ={<span class="st">&quot;SELECT * FROM robologger.robodata ORDER BY id DESC LIMIT </span><span class="sc">%s</span><span class="st">&quot;</span>};</a>
<a class="sourceLine" id="cb4-64" title="64"><span class="co">// general format to insert data is:</span></a>
<a class="sourceLine" id="cb4-65" title="65"><span class="co">//const char insertdata[] = &quot;INSERT INTO ardulogger.ardudata (date,time,temp,humi) VALUES (&#39;2014-11-11&#39;,&#39;11:45:11&#39;, 25.8 , 31.21)&quot;;</span></a>
<a class="sourceLine" id="cb4-66" title="66"><span class="co">//const char insertdata[] = {&quot;INSERT INTO ardulogger.ardudata (date,time,temp,humi) VALUES (&#39;%s-%s-%s&#39;,&#39;%s:%s:%s&#39;, %s , %s)&quot;};</span></a>
<a class="sourceLine" id="cb4-67" title="67"><span class="at">const</span> <span class="dt">char</span> insertdata[] = {<span class="st">&quot;INSERT INTO robologger.robodata (date,time,temp,humi) VALUES (&#39;</span><span class="sc">%s</span><span class="st">-</span><span class="sc">%s</span><span class="st">-</span><span class="sc">%s</span><span class="st">&#39;,&#39;</span><span class="sc">%s</span><span class="st">:</span><span class="sc">%s</span><span class="st">:</span><span class="sc">%s</span><span class="st">&#39;, </span><span class="sc">%s</span><span class="st"> , </span><span class="sc">%s</span><span class="st">)&quot;</span>};</a>
<a class="sourceLine" id="cb4-68" title="68"><span class="co">// buffer for number to character conversion</span></a>
<a class="sourceLine" id="cb4-69" title="69"><span class="dt">char</span> yearbuf[<span class="dv">5</span>];</a>
<a class="sourceLine" id="cb4-70" title="70"><span class="dt">char</span> monthbuf[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb4-71" title="71"><span class="dt">char</span> daybuf[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb4-72" title="72"><span class="dt">char</span> hourbuf[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb4-73" title="73"><span class="dt">char</span> minutebuf[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb4-74" title="74">String temp_buf;</a>
<a class="sourceLine" id="cb4-75" title="75"><span class="dt">char</span> secbuf[<span class="dv">3</span>];</a>
<a class="sourceLine" id="cb4-76" title="76"><span class="dt">char</span> tempbuf[<span class="dv">6</span>];</a>
<a class="sourceLine" id="cb4-77" title="77"><span class="dt">char</span> humibuf[<span class="dv">5</span>];</a>
<a class="sourceLine" id="cb4-78" title="78"><span class="dt">int</span> timebuf;</a>
<a class="sourceLine" id="cb4-79" title="79"></a>
<a class="sourceLine" id="cb4-80" title="80"> </a>
<a class="sourceLine" id="cb4-81" title="81"><span class="dt">void</span> setup() {</a>
<a class="sourceLine" id="cb4-82" title="82">   Serial.begin(<span class="dv">9600</span>);</a>
<a class="sourceLine" id="cb4-83" title="83">   </a>
<a class="sourceLine" id="cb4-84" title="84">   <span class="co">// Ethernet shield and NTP setup</span></a>
<a class="sourceLine" id="cb4-85" title="85">   <span class="dt">int</span> i = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-86" title="86">   <span class="dt">int</span> DHCP = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-87" title="87">   DHCP = Ethernet.begin(mac);</a>
<a class="sourceLine" id="cb4-88" title="88">   <span class="co">//Try to get dhcp settings 30 times before giving up</span></a>
<a class="sourceLine" id="cb4-89" title="89">   <span class="cf">while</span>( DHCP == <span class="dv">0</span> &amp;&amp; i &lt; <span class="dv">30</span>){</a>
<a class="sourceLine" id="cb4-90" title="90">     delay(<span class="dv">1000</span>);</a>
<a class="sourceLine" id="cb4-91" title="91">     DHCP = Ethernet.begin(mac);</a>
<a class="sourceLine" id="cb4-92" title="92">     i++;</a>
<a class="sourceLine" id="cb4-93" title="93">   }</a>
<a class="sourceLine" id="cb4-94" title="94">   <span class="cf">if</span>(!DHCP){</a>
<a class="sourceLine" id="cb4-95" title="95">    Serial.println(<span class="st">&quot;DHCP FAILED&quot;</span>);</a>
<a class="sourceLine" id="cb4-96" title="96">     <span class="cf">for</span>(;;); <span class="co">//Infinite loop because DHCP Failed</span></a>
<a class="sourceLine" id="cb4-97" title="97">   }</a>
<a class="sourceLine" id="cb4-98" title="98">   Serial.println(<span class="st">&quot;DHCP Success&quot;</span>);  </a>
<a class="sourceLine" id="cb4-99" title="99"> </a>
<a class="sourceLine" id="cb4-100" title="100">   <span class="co">//Just for testing we print the obtained IP address  </span></a>
<a class="sourceLine" id="cb4-101" title="101">   Serial.print(<span class="st">&quot;My IP address: &quot;</span>);</a>
<a class="sourceLine" id="cb4-102" title="102">   <span class="cf">for</span> (byte thisByte = <span class="dv">0</span>; thisByte &lt; <span class="dv">4</span>; thisByte++) {</a>
<a class="sourceLine" id="cb4-103" title="103">    <span class="co">// print the value of each byte of the IP address:</span></a>
<a class="sourceLine" id="cb4-104" title="104">   Serial.print(Ethernet.localIP()[thisByte], DEC);</a>
<a class="sourceLine" id="cb4-105" title="105">   Serial.print(<span class="st">&quot;.&quot;</span>);</a>
<a class="sourceLine" id="cb4-106" title="106">   }</a>
<a class="sourceLine" id="cb4-107" title="107">   Serial.println();</a>
<a class="sourceLine" id="cb4-108" title="108"> </a>
<a class="sourceLine" id="cb4-109" title="109">  <span class="co">// We get the address of a NTP server from NTP pool</span></a>
<a class="sourceLine" id="cb4-110" title="110">  DNSClient dns;</a>
<a class="sourceLine" id="cb4-111" title="111">  dns.begin(Ethernet.dnsServerIP());</a>
<a class="sourceLine" id="cb4-112" title="112">  dns.getHostByName(<span class="st">&quot;ro.pool.ntp.org&quot;</span>,timeServer);</a>
<a class="sourceLine" id="cb4-113" title="113">  Serial.print(<span class="st">&quot;NTP IP from the pool: &quot;</span>);</a>
<a class="sourceLine" id="cb4-114" title="114">  Serial.println(timeServer);</a>
<a class="sourceLine" id="cb4-115" title="115"> </a>
<a class="sourceLine" id="cb4-116" title="116">  <span class="co">// Now we get the time</span></a>
<a class="sourceLine" id="cb4-117" title="117">  Serial.println(<span class="st">&quot;trying to get the time&quot;</span>);</a>
<a class="sourceLine" id="cb4-118" title="118">  <span class="dt">int</span> trys=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-119" title="119">      <span class="cf">while</span>(!getTimeAndDate() &amp;&amp; trys&lt;<span class="dv">10</span>){</a>
<a class="sourceLine" id="cb4-120" title="120">        trys++;</a>
<a class="sourceLine" id="cb4-121" title="121">      }</a>
<a class="sourceLine" id="cb4-122" title="122">      <span class="cf">if</span>(trys&lt;<span class="dv">10</span>){</a>
<a class="sourceLine" id="cb4-123" title="123">        Serial.println(<span class="st">&quot;Ntp server update success&quot;</span>);</a>
<a class="sourceLine" id="cb4-124" title="124">      }</a>
<a class="sourceLine" id="cb4-125" title="125">      <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb4-126" title="126">        Serial.println(<span class="st">&quot;Ntp server update failed&quot;</span>);</a>
<a class="sourceLine" id="cb4-127" title="127">      }</a>
<a class="sourceLine" id="cb4-128" title="128">  <span class="co">// Print the time</span></a>
<a class="sourceLine" id="cb4-129" title="129">  clockDisplay();</a>
<a class="sourceLine" id="cb4-130" title="130"> </a>
<a class="sourceLine" id="cb4-131" title="131">  <span class="co">// We have the right time, now we set the RTC clock</span></a>
<a class="sourceLine" id="cb4-132" title="132">  <span class="cf">if</span> (RTC.read(tm)) {</a>
<a class="sourceLine" id="cb4-133" title="133">       Serial.println(<span class="st">&quot;The DS1307 is running.&quot;</span>);</a>
<a class="sourceLine" id="cb4-134" title="134">       Serial.println(<span class="st">&quot;Updating the RTC time.&quot;</span>);</a>
<a class="sourceLine" id="cb4-135" title="135">       Serial.println();</a>
<a class="sourceLine" id="cb4-136" title="136">       tm.Day = day();</a>
<a class="sourceLine" id="cb4-137" title="137">       tm.Month = month();</a>
<a class="sourceLine" id="cb4-138" title="138">       tm.Year = year()-<span class="dv">1970</span>;</a>
<a class="sourceLine" id="cb4-139" title="139">       tm.Hour = hour();</a>
<a class="sourceLine" id="cb4-140" title="140">       tm.Minute = minute();</a>
<a class="sourceLine" id="cb4-141" title="141">       tm.Second = second();</a>
<a class="sourceLine" id="cb4-142" title="142">       RTC.write(tm);   <span class="co">//update the time</span></a>
<a class="sourceLine" id="cb4-143" title="143">  } <span class="cf">else</span> <span class="cf">if</span> (RTC.chipPresent()) {</a>
<a class="sourceLine" id="cb4-144" title="144">       Serial.println(<span class="st">&quot;The RTC stopped.&quot;</span>);</a>
<a class="sourceLine" id="cb4-145" title="145">       Serial.println(<span class="st">&quot;Setting the RTC time.&quot;</span>);</a>
<a class="sourceLine" id="cb4-146" title="146">       Serial.println();</a>
<a class="sourceLine" id="cb4-147" title="147">       tm.Day = day();</a>
<a class="sourceLine" id="cb4-148" title="148">       tm.Month = month();</a>
<a class="sourceLine" id="cb4-149" title="149">       tm.Year = year()-<span class="dv">1970</span>;</a>
<a class="sourceLine" id="cb4-150" title="150">       tm.Hour = hour();</a>
<a class="sourceLine" id="cb4-151" title="151">       tm.Minute = minute();</a>
<a class="sourceLine" id="cb4-152" title="152">       tm.Second = second();</a>
<a class="sourceLine" id="cb4-153" title="153">       RTC.write(tm);   <span class="co">//update the time</span></a>
<a class="sourceLine" id="cb4-154" title="154">   }</a>
<a class="sourceLine" id="cb4-155" title="155">   <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb4-156" title="156">       Serial.println(<span class="st">&quot;RTC read error!  Please check the circuitry.&quot;</span>);</a>
<a class="sourceLine" id="cb4-157" title="157">       Serial.println();</a>
<a class="sourceLine" id="cb4-158" title="158">   }</a>
<a class="sourceLine" id="cb4-159" title="159">   <span class="co">// Just in case we read the RTC time for debugging purposes</span></a>
<a class="sourceLine" id="cb4-160" title="160">   <span class="co">// Serial.println(&quot;Computing the next DB access time&quot;);</span></a>
<a class="sourceLine" id="cb4-161" title="161">    RTC.read(tm);</a>
<a class="sourceLine" id="cb4-162" title="162">    minutes_now=tm.Minute;</a>
<a class="sourceLine" id="cb4-163" title="163">   <span class="co">// minutes_next=floor(tm.Minute/10)*10+10;</span></a>
<a class="sourceLine" id="cb4-164" title="164">    minutes_next=minutes_now+<span class="dv">1</span>; <span class="co">//debgging - write every minute to DB</span></a>
<a class="sourceLine" id="cb4-165" title="165">    <span class="cf">if</span> (minutes_next==<span class="dv">60</span>)</a>
<a class="sourceLine" id="cb4-166" title="166">      minutes_next=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-167" title="167">    Serial.print(<span class="st">&quot;Current minute: &quot;</span>);</a>
<a class="sourceLine" id="cb4-168" title="168">    Serial.print(minutes_now);</a>
<a class="sourceLine" id="cb4-169" title="169">    Serial.println();</a>
<a class="sourceLine" id="cb4-170" title="170">    Serial.print(<span class="st">&quot;Minute for the next database write: &quot;</span>);</a>
<a class="sourceLine" id="cb4-171" title="171">    Serial.print(minutes_next);</a>
<a class="sourceLine" id="cb4-172" title="172">    Serial.println();</a>
<a class="sourceLine" id="cb4-173" title="173"></a>
<a class="sourceLine" id="cb4-174" title="174">} <span class="co">//end of setup</span></a>
<a class="sourceLine" id="cb4-175" title="175"></a>
<a class="sourceLine" id="cb4-176" title="176"></a>
<a class="sourceLine" id="cb4-177" title="177"><span class="co">// functions for NTP server</span></a>
<a class="sourceLine" id="cb4-178" title="178"><span class="co">// Do not alter this function, it is used by the system</span></a>
<a class="sourceLine" id="cb4-179" title="179"><span class="dt">int</span> getTimeAndDate() {</a>
<a class="sourceLine" id="cb4-180" title="180">   <span class="dt">int</span> flag=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-181" title="181">   Udp.begin(localPort);</a>
<a class="sourceLine" id="cb4-182" title="182">   sendNTPpacket(timeServer);</a>
<a class="sourceLine" id="cb4-183" title="183">   delay(<span class="dv">1000</span>);</a>
<a class="sourceLine" id="cb4-184" title="184">   <span class="cf">if</span> (Udp.parsePacket()){</a>
<a class="sourceLine" id="cb4-185" title="185">     Udp.read(packetBuffer,NTP_PACKET_SIZE);  <span class="co">// read the packet into the buffer</span></a>
<a class="sourceLine" id="cb4-186" title="186">     <span class="dt">unsigned</span> <span class="dt">long</span> highWord, lowWord, epoch;</a>
<a class="sourceLine" id="cb4-187" title="187">     highWord = word(packetBuffer[<span class="dv">40</span>], packetBuffer[<span class="dv">41</span>]);</a>
<a class="sourceLine" id="cb4-188" title="188">     lowWord = word(packetBuffer[<span class="dv">42</span>], packetBuffer[<span class="dv">43</span>]);  </a>
<a class="sourceLine" id="cb4-189" title="189">     epoch = highWord &lt;&lt; <span class="dv">16</span> | lowWord;</a>
<a class="sourceLine" id="cb4-190" title="190">     epoch = epoch - <span class="dv">2208988800</span> + timeZoneOffset;</a>
<a class="sourceLine" id="cb4-191" title="191">     flag=<span class="dv">1</span>;</a>
<a class="sourceLine" id="cb4-192" title="192">     setTime(epoch);</a>
<a class="sourceLine" id="cb4-193" title="193">     <span class="co">//ntpLastUpdate = now();  not needed anymore as we update the time only once</span></a>
<a class="sourceLine" id="cb4-194" title="194">   }</a>
<a class="sourceLine" id="cb4-195" title="195">   <span class="cf">return</span> flag;</a>
<a class="sourceLine" id="cb4-196" title="196">}</a>
<a class="sourceLine" id="cb4-197" title="197"> </a>
<a class="sourceLine" id="cb4-198" title="198"><span class="co">// Do not alter this function, it is used by the system</span></a>
<a class="sourceLine" id="cb4-199" title="199"><span class="dt">unsigned</span> <span class="dt">long</span> sendNTPpacket(IPAddress&amp; address)</a>
<a class="sourceLine" id="cb4-200" title="200">{</a>
<a class="sourceLine" id="cb4-201" title="201">  memset(packetBuffer, <span class="dv">0</span>, NTP_PACKET_SIZE);</a>
<a class="sourceLine" id="cb4-202" title="202">  packetBuffer[<span class="dv">0</span>] = <span class="bn">0b11100011</span>;</a>
<a class="sourceLine" id="cb4-203" title="203">  packetBuffer[<span class="dv">1</span>] = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-204" title="204">  packetBuffer[<span class="dv">2</span>] = <span class="dv">6</span>;</a>
<a class="sourceLine" id="cb4-205" title="205">  packetBuffer[<span class="dv">3</span>] = <span class="bn">0xEC</span>;</a>
<a class="sourceLine" id="cb4-206" title="206">  packetBuffer[<span class="dv">12</span>]  = <span class="dv">49</span>;</a>
<a class="sourceLine" id="cb4-207" title="207">  packetBuffer[<span class="dv">13</span>]  = <span class="bn">0x4E</span>;</a>
<a class="sourceLine" id="cb4-208" title="208">  packetBuffer[<span class="dv">14</span>]  = <span class="dv">49</span>;</a>
<a class="sourceLine" id="cb4-209" title="209">  packetBuffer[<span class="dv">15</span>]  = <span class="dv">52</span>;                  </a>
<a class="sourceLine" id="cb4-210" title="210">  Udp.beginPacket(address, <span class="dv">123</span>);</a>
<a class="sourceLine" id="cb4-211" title="211">  Udp.write(packetBuffer,NTP_PACKET_SIZE);</a>
<a class="sourceLine" id="cb4-212" title="212">  Udp.endPacket();</a>
<a class="sourceLine" id="cb4-213" title="213">}</a>
<a class="sourceLine" id="cb4-214" title="214"></a>
<a class="sourceLine" id="cb4-215" title="215"><span class="co">// Clock display of the time and date (Basic)</span></a>
<a class="sourceLine" id="cb4-216" title="216"><span class="dt">void</span> clockDisplay(){</a>
<a class="sourceLine" id="cb4-217" title="217">  Serial.print(hour());</a>
<a class="sourceLine" id="cb4-218" title="218">  printDigits(minute());</a>
<a class="sourceLine" id="cb4-219" title="219">  printDigits(second());</a>
<a class="sourceLine" id="cb4-220" title="220">  Serial.print(<span class="st">&quot; &quot;</span>);</a>
<a class="sourceLine" id="cb4-221" title="221">  Serial.print(day());</a>
<a class="sourceLine" id="cb4-222" title="222">  Serial.print(<span class="st">&quot; &quot;</span>);</a>
<a class="sourceLine" id="cb4-223" title="223">  Serial.print(month());</a>
<a class="sourceLine" id="cb4-224" title="224">  Serial.print(<span class="st">&quot; &quot;</span>);</a>
<a class="sourceLine" id="cb4-225" title="225">  Serial.print(year());</a>
<a class="sourceLine" id="cb4-226" title="226">  Serial.println();</a>
<a class="sourceLine" id="cb4-227" title="227">}</a>
<a class="sourceLine" id="cb4-228" title="228"> </a>
<a class="sourceLine" id="cb4-229" title="229"><span class="co">// Utility function for clock display: prints preceding colon and leading 0</span></a>
<a class="sourceLine" id="cb4-230" title="230"><span class="dt">void</span> printDigits(<span class="dt">int</span> digits){</a>
<a class="sourceLine" id="cb4-231" title="231">  Serial.print(<span class="st">&quot;:&quot;</span>);</a>
<a class="sourceLine" id="cb4-232" title="232">  <span class="cf">if</span>(digits &lt; <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb4-233" title="233">    Serial.print(<span class="ch">&#39;0&#39;</span>);</a>
<a class="sourceLine" id="cb4-234" title="234">    Serial.print(digits);</a>
<a class="sourceLine" id="cb4-235" title="235">}</a>
<a class="sourceLine" id="cb4-236" title="236"><span class="co">// End of NTP functions</span></a>
<a class="sourceLine" id="cb4-237" title="237"></a>
<a class="sourceLine" id="cb4-238" title="238"><span class="dt">void</span> print2digits(<span class="dt">int</span> number) {</a>
<a class="sourceLine" id="cb4-239" title="239">  <span class="cf">if</span> (number &gt;= <span class="dv">0</span> &amp;&amp; number &lt; <span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb4-240" title="240">    Serial.write(<span class="ch">&#39;0&#39;</span>);</a>
<a class="sourceLine" id="cb4-241" title="241">  }</a>
<a class="sourceLine" id="cb4-242" title="242">  Serial.print(number);</a>
<a class="sourceLine" id="cb4-243" title="243">}</a>
<a class="sourceLine" id="cb4-244" title="244"></a>
<a class="sourceLine" id="cb4-245" title="245"></a>
<a class="sourceLine" id="cb4-246" title="246"></a>
<a class="sourceLine" id="cb4-247" title="247"><span class="dt">void</span> loop(){</a>
<a class="sourceLine" id="cb4-248" title="248"> </a>
<a class="sourceLine" id="cb4-249" title="249">    RTC.read(tm);</a>
<a class="sourceLine" id="cb4-250" title="250">    minutes_now=tm.Minute;</a>
<a class="sourceLine" id="cb4-251" title="251">    <span class="cf">if</span> (minutes_now==minutes_next){</a>
<a class="sourceLine" id="cb4-252" title="252">    <span class="co">//if (time_now.Minute==minutes_next){  </span></a>
<a class="sourceLine" id="cb4-253" title="253">       <span class="co">// compute the next time for write</span></a>
<a class="sourceLine" id="cb4-254" title="254">       <span class="co">//minutes_next=floor(tm.Minute/10)*10+10; // write every 10 minutes - normal mode</span></a>
<a class="sourceLine" id="cb4-255" title="255">       minutes_next=minutes_now+<span class="dv">1</span>; <span class="co">// write every minute - debug mode</span></a>
<a class="sourceLine" id="cb4-256" title="256">       <span class="cf">if</span> (minutes_next==<span class="dv">60</span>)</a>
<a class="sourceLine" id="cb4-257" title="257">       minutes_next=<span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-258" title="258">       temp_c = sht1x.readTemperatureC();</a>
<a class="sourceLine" id="cb4-259" title="259">       humidity = sht1x.readHumidity();</a>
<a class="sourceLine" id="cb4-260" title="260">       <span class="co">// we construct the INSERT code here</span></a>
<a class="sourceLine" id="cb4-261" title="261">       <span class="co">// first we initialize the buffers</span></a>
<a class="sourceLine" id="cb4-262" title="262">       temp_buf=String(tm.Year+<span class="dv">1970</span>);</a>
<a class="sourceLine" id="cb4-263" title="263">       temp_buf.trim();</a>
<a class="sourceLine" id="cb4-264" title="264">       temp_buf.toCharArray(yearbuf,<span class="dv">5</span>);</a>
<a class="sourceLine" id="cb4-265" title="265">       temp_buf=String(tm.Month);</a>
<a class="sourceLine" id="cb4-266" title="266">       temp_buf.trim();</a>
<a class="sourceLine" id="cb4-267" title="267">       temp_buf.toCharArray(monthbuf,<span class="dv">3</span>);</a>
<a class="sourceLine" id="cb4-268" title="268">       temp_buf=String(tm.Day);</a>
<a class="sourceLine" id="cb4-269" title="269">       temp_buf.trim();</a>
<a class="sourceLine" id="cb4-270" title="270">       temp_buf.toCharArray(daybuf,<span class="dv">3</span>);</a>
<a class="sourceLine" id="cb4-271" title="271">       temp_buf=String(tm.Hour);</a>
<a class="sourceLine" id="cb4-272" title="272">       temp_buf.trim();</a>
<a class="sourceLine" id="cb4-273" title="273">       temp_buf.toCharArray(hourbuf,<span class="dv">3</span>);</a>
<a class="sourceLine" id="cb4-274" title="274">       temp_buf=String(tm.Minute);</a>
<a class="sourceLine" id="cb4-275" title="275">       temp_buf.trim();</a>
<a class="sourceLine" id="cb4-276" title="276">       temp_buf.toCharArray(minutebuf,<span class="dv">3</span>);</a>
<a class="sourceLine" id="cb4-277" title="277">       temp_buf=String(tm.Second);</a>
<a class="sourceLine" id="cb4-278" title="278">       temp_buf.trim();</a>
<a class="sourceLine" id="cb4-279" title="279">       temp_buf.toCharArray(secbuf,<span class="dv">3</span>);</a>
<a class="sourceLine" id="cb4-280" title="280">       <span class="co">//  float to char conversion</span></a>
<a class="sourceLine" id="cb4-281" title="281">       dtostrf(temp_c, <span class="dv">5</span> , <span class="dv">2</span>, tempbuf);</a>
<a class="sourceLine" id="cb4-282" title="282">       dtostrf(humidity, <span class="dv">5</span>, <span class="dv">2</span>, humibuf);</a>
<a class="sourceLine" id="cb4-283" title="283">       <span class="co">// now we build the command for data insertion</span></a>
<a class="sourceLine" id="cb4-284" title="284">       sprintf(insquery,insertdata,yearbuf,monthbuf,daybuf,hourbuf,minutebuf,secbuf,tempbuf,humibuf);</a>
<a class="sourceLine" id="cb4-285" title="285">       <span class="co">//ready to work with the database</span></a>
<a class="sourceLine" id="cb4-286" title="286">       Serial.println(<span class="st">&quot;DB write: &quot;</span>);</a>
<a class="sourceLine" id="cb4-287" title="287">       <span class="co">// Here comes the MySQL data code</span></a>
<a class="sourceLine" id="cb4-288" title="288">       <span class="cf">if</span> (my_conn.mysql_connect(server_addr, <span class="dv">3306</span>, user, password))  {</a>
<a class="sourceLine" id="cb4-289" title="289">          <span class="co">// check for connection</span></a>
<a class="sourceLine" id="cb4-290" title="290">          <span class="cf">if</span> (my_conn.is_connected()) {</a>
<a class="sourceLine" id="cb4-291" title="291">            Serial.println(<span class="st">&quot;Last 5 DB entries!&quot;</span>);</a>
<a class="sourceLine" id="cb4-292" title="292">            sprintf(myquery,testselect,<span class="st">&quot;5&quot;</span>);</a>
<a class="sourceLine" id="cb4-293" title="293">            Serial.println(myquery);</a>
<a class="sourceLine" id="cb4-294" title="294">            my_conn.cmd_query(myquery);</a>
<a class="sourceLine" id="cb4-295" title="295">            delay(<span class="dv">250</span>); <span class="co">// small delay to wait for MySQl server to respond</span></a>
<a class="sourceLine" id="cb4-296" title="296">            my_conn.show_results();</a>
<a class="sourceLine" id="cb4-297" title="297">            delay(<span class="dv">1000</span>);</a>
<a class="sourceLine" id="cb4-298" title="298">            Serial.println(<span class="st">&quot;Inserting new data!&quot;</span>);</a>
<a class="sourceLine" id="cb4-299" title="299">            Serial.println(insquery);</a>
<a class="sourceLine" id="cb4-300" title="300">            my_conn.cmd_query(insquery);</a>
<a class="sourceLine" id="cb4-301" title="301">            delay(<span class="dv">1500</span>); <span class="co">// small delay to wait for MySQl server to respond</span></a>
<a class="sourceLine" id="cb4-302" title="302">            <span class="co">// We verify the last entered data</span></a>
<a class="sourceLine" id="cb4-303" title="303">            Serial.println(<span class="st">&quot;New data entered!&quot;</span>);</a>
<a class="sourceLine" id="cb4-304" title="304">            sprintf(myquery,testselect,<span class="st">&quot;1&quot;</span>);</a>
<a class="sourceLine" id="cb4-305" title="305">            Serial.println(myquery);</a>
<a class="sourceLine" id="cb4-306" title="306">            my_conn.cmd_query(myquery);</a>
<a class="sourceLine" id="cb4-307" title="307">            delay(<span class="dv">250</span>); <span class="co">// small delay to wait for MySQl server to respond</span></a>
<a class="sourceLine" id="cb4-308" title="308">            my_conn.show_results();</a>
<a class="sourceLine" id="cb4-309" title="309">            num_fails = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb4-310" title="310">            } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb4-311" title="311">            <span class="co">//my_conn.disconnect();</span></a>
<a class="sourceLine" id="cb4-312" title="312">            Serial.println(<span class="st">&quot;Connecting again...&quot;</span>);</a>
<a class="sourceLine" id="cb4-313" title="313">            <span class="cf">if</span> (my_conn.mysql_connect(server_addr, <span class="dv">3306</span>, user, password)) {</a>
<a class="sourceLine" id="cb4-314" title="314">            delay(<span class="dv">500</span>);</a>
<a class="sourceLine" id="cb4-315" title="315">            Serial.println(<span class="st">&quot;Success!&quot;</span>);</a>
<a class="sourceLine" id="cb4-316" title="316">            } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb4-317" title="317">            num_fails++;</a>
<a class="sourceLine" id="cb4-318" title="318">            Serial.println(<span class="st">&quot;Connect failed!&quot;</span>);</a>
<a class="sourceLine" id="cb4-319" title="319">              <span class="cf">if</span> (num_fails == MAX_FAILED_CONNECTS) {</a>
<a class="sourceLine" id="cb4-320" title="320">                Serial.println(<span class="st">&quot;No MySQL server available...&quot;</span>);</a>
<a class="sourceLine" id="cb4-321" title="321">                delay(<span class="dv">2000</span>);</a>
<a class="sourceLine" id="cb4-322" title="322">                }</a>
<a class="sourceLine" id="cb4-323" title="323">              }</a>
<a class="sourceLine" id="cb4-324" title="324">           }</a>
<a class="sourceLine" id="cb4-325" title="325">       <span class="co">// close the database connection</span></a>
<a class="sourceLine" id="cb4-326" title="326">       my_conn.<span class="fu">disconnect</span>();   </a>
<a class="sourceLine" id="cb4-327" title="327">       }</a>
<a class="sourceLine" id="cb4-328" title="328">  }</a>
<a class="sourceLine" id="cb4-329" title="329"></a>
<a class="sourceLine" id="cb4-330" title="330">    <span class="co">// Just prints the time so we know we are not stuck</span></a>
<a class="sourceLine" id="cb4-331" title="331">    Serial.print(<span class="st">&quot;Current time is  &quot;</span>);</a>
<a class="sourceLine" id="cb4-332" title="332">    print2digits(tm.Hour);</a>
<a class="sourceLine" id="cb4-333" title="333">    Serial.write(<span class="ch">&#39;:&#39;</span>);</a>
<a class="sourceLine" id="cb4-334" title="334">    print2digits(tm.Minute);</a>
<a class="sourceLine" id="cb4-335" title="335">    Serial.write(<span class="ch">&#39;:&#39;</span>);</a>
<a class="sourceLine" id="cb4-336" title="336">    print2digits(tm.Second);</a>
<a class="sourceLine" id="cb4-337" title="337">    Serial.println();</a>
<a class="sourceLine" id="cb4-338" title="338">    </a>
<a class="sourceLine" id="cb4-339" title="339">    <span class="co">// Basically we check the time every 5 seconds. You can increase this</span></a>
<a class="sourceLine" id="cb4-340" title="340">    delay(<span class="dv">5000</span>);</a>
<a class="sourceLine" id="cb4-341" title="341"></a>
<a class="sourceLine" id="cb4-342" title="342"></a>
<a class="sourceLine" id="cb4-343" title="343">}</a>
<a class="sourceLine" id="cb4-344" title="344"> </a>
<a class="sourceLine" id="cb4-345" title="345"></a></code></pre></div>
</body>
</html>
